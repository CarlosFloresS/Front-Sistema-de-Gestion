<app-navbar></app-navbar>

<div class="form-page-container">
  <div class="form-card-grid">

    <!-- Barra Lateral (Izquierda) - Contenido Estático -->
    <div class="form-sidebar">
      <div class="sidebar-content">
        <mat-icon class="sidebar-icon">precision_manufacturing</mat-icon>
        <h2>Nueva Producción</h2>
        <p>
          Registra un nuevo lote de producción para añadirlo al inventario.
        </p>
      </div>
    </div>

    <!-- Área Principal (Derecha) - El Formulario -->
    <div class="form-main">
      <form [formGroup]="form" (ngSubmit)="submit()">

        <!-- Selector de Producto -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Producto</mat-label>
          <mat-select formControlName="productoId">
            <mat-option *ngFor="let p of products$ | async" [value]="p.id">
              {{ p.nombre }}
            </mat-option>
          </mat-select>
          <!-- CORRECCIÓN: Se añadió el mensaje de error para el campo productoId -->
          <mat-error *ngIf="form.get('productoId')?.hasError('required')">
            Debes seleccionar un producto.
          </mat-error>
        </mat-form-field>

        <!-- El selector de fecha fue eliminado correctamente -->

        <!-- Campo de Cantidad -->
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Cantidad Producida</mat-label>
          <input matInput type="number" formControlName="cantidad" />
          <mat-error *ngIf="form.get('cantidad')?.hasError('required')">
            La cantidad es obligatoria.
          </mat-error>
          <mat-error *ngIf="form.get('cantidad')?.hasError('min')">
            Debe ser al menos 1.
          </mat-error>
        </mat-form-field>

        <!-- Botonera de Acciones -->
        <div class="form-actions">
          <button mat-button type="button" (click)="cancel()">Cancelar</button>

          <button mat-flat-button class="main-action-btn" type="submit" [disabled]="form.invalid || isLoading">
            <span *ngIf="!isLoading">Registrar Producción</span>
            <mat-spinner *ngIf="isLoading" diameter="24"></mat-spinner>
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
